
{% extends "layout.twig" %}


{% block content %}

{% if flash %}
  <div 
    id="toast"
    class="fixed top-5 right-5 px-4 py-3 rounded-lg shadow-lg text-white 
    {% if flash.type == 'success' %}bg-green-600{% elseif flash.type == 'error' %}bg-red-600{% elseif flash.type == 'delete' %}bg-gray-700{% endif %}
    transition transform duration-500 ease-in-out z-50"
  >
    {{ flash.message }}
  </div>

  <script>
    setTimeout(() => {
      const toast = document.getElementById('toast');
      if (toast) {
        toast.style.opacity = '0';
        toast.style.transform = 'translateY(-20px)';
        setTimeout(() => toast.remove(), 500);
      }
    }, 2500);
  </script>
{% endif %}

<h2 class="text-2xl font-bold mb-6">Ticket Management</h2>

{% if error %}
  <div class="bg-red-100 text-red-700 p-3 mb-4 rounded">{{ error }}</div>
{% endif %}

<div class="bg-white p-6 shadow rounded-xl mb-8">
  {% if editTicket %}
    <h3 class="text-xl font-semibold mb-4">Edit Ticket</h3>
    <form method="POST" class="space-y-4">
      <input type="hidden" name="action" value="update">
      <input type="hidden" name="id" value="{{ editTicket.id }}">

      <div>
        <label>Title</label>
        <input name="title" value="{{ editTicket.title }}" required class="w-full border rounded-lg p-2">
      </div>

      <div>
        <label>Status</label>
        <select name="status" required class="w-full border rounded-lg p-2">
          <option value="open" {% if editTicket.status == 'open' %}selected{% endif %}>Open</option>
          <option value="in_progress" {% if editTicket.status == 'in_progress' %}selected{% endif %}>In Progress</option>
          <option value="closed" {% if editTicket.status == 'closed' %}selected{% endif %}>Closed</option>
        </select>
      </div>

      <div>
        <label>Description</label>
        <textarea name="description" class="w-full border rounded-lg p-2">{{ editTicket.description }}</textarea>
      </div>

      <div class="flex space-x-3">
        <button class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">Update</button>
        <a href="/tickets" class="border border-gray-300 px-6 py-2 rounded-lg hover:bg-gray-100">Cancel</a>
      </div>
    </form>
  {% else %}
    <h3 class="text-xl font-semibold mb-4">Add New Ticket</h3>
    <form method="POST" class="space-y-4">
      <input type="hidden" name="action" value="create">

      <div>
        <label>Title</label>
        <input name="title" required class="w-full border rounded-lg p-2">
      </div>

      <div>
        <label>Status</label>
        <select name="status" required class="w-full border rounded-lg p-2">
          <option value="">Select status</option>
          <option value="open">Open</option>
          <option value="in_progress">In Progress</option>
          <option value="closed">Closed</option>
        </select>
      </div>

      <div>
        <label>Description</label>
        <textarea name="description" class="w-full border rounded-lg p-2"></textarea>
      </div>

      <button class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">Add Ticket</button>
    </form>
  {% endif %}
</div>

<h3 class="text-xl font-semibold mb-4">Existing Tickets</h3>
<div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
  {% for ticket in tickets %}
    <div class="bg-white shadow rounded-xl p-4">
      <h3 class="font-semibold text-lg">{{ ticket.title }}</h3>
      <p class="text-sm text-gray-500 mb-3">{{ ticket.description }}</p>

      <span class="
        inline-block px-3 py-1 rounded-full text-sm font-semibold mb-4
        {% if ticket.status == 'open' %}bg-green-100 text-green-700{% endif %}
        {% if ticket.status == 'in_progress' %}bg-amber-100 text-amber-700{% endif %}
        {% if ticket.status == 'closed' %}bg-gray-200 text-gray-700{% endif %}
      ">
        {{ ticket.status }}
      </span>

      <div class="flex space-x-2">
        <a href="/tickets?edit={{ ticket.id }}" class="text-blue-600 hover:underline">Edit</a>
        <a href="/tickets?delete={{ ticket.id }}" onclick="return confirm('Are you sure you want to delete this ticket?')" class="text-red-600 hover:underline">Delete</a>
      </div>
    </div>
  {% else %}
    <p>No tickets found.</p>
  {% endfor %}
</div>
{% endblock %}